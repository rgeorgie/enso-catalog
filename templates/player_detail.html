{% extends "base.html" %}

{% block content %}
<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
  <h2 class="m-0">
    {{ player.full_name() }}
    <small class="text-muted">#{{ player.id }}</small>
  </h2>

  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{{ url_for('list_players') }}">‚Üê {{ _('Back') }}</a>
    <a class="btn btn-outline-primary" href="{{ url_for('edit_player', player_id=player.id) }}">‚úèÔ∏è {{ _('Edit') }}</a>
  </div>
</div>

{% if payment_count == 0 %}
<div class="mb-3">
  <span class="badge text-bg-warning text-dark">{{ _('No payments recorded.') }}</span>
</div>
{% endif %}

{% if current_payment %}
<div class="mb-3">
  {% if current_payment.paid %}
    <span class="badge bg-success">
      {{ _('Monthly Due') }}: {{ current_payment.amount or 0 }} EUR ({{ _('Paid') }})
    </span>
  {% else %}
    <span class="badge bg-danger">
      {{ _('Monthly Due') }}: {{ current_payment.amount or 0 }} EUR ({{ _('Unpaid') }})
    </span>
  {% endif %}
</div>
{% endif %}

<div class="row g-3">
  <!-- LEFT COLUMN -->
  <div class="col-12 col-lg-4">

    <!-- PHOTO -->
    <div class="card mb-3">
      <div class="card-body d-flex flex-column align-items-center">
        {% if player.photo_filename %}
          <img src="{{ url_for('uploaded_file', filename=player.photo_filename) }}"
               alt="{{ player.full_name() }}" style="max-height:240px;width:auto;">
        {% else %}
          <div class="text-muted text-center"
               style="height:180px;display:flex;align-items:center;justify-content:center;background:#f8f9fa;border-radius:.5rem;">
            {{ _('No photo uploaded') }}
          </div>
        {% endif %}
        <div class="mt-2">
          <span style="{{ belt_chip_style(player.belt_rank) | safe }}">
            {% set gl = player.grade_level %}
            {% if gl in ['10 kyu','9 kyu','8 kyu','7 kyu','6 kyu','5 kyu','4 kyu','3 kyu','2 kyu','1 kyu'] %}
              {{ _(gl ~ ' ‚Äì ' ~ {
                '10 kyu': 'white belt',
                '9 kyu': 'white with yellow stripe',
                '8 kyu': 'yellow belt',
                '7 kyu': 'orange belt',
                '6 kyu': 'orange belt',
                '5 kyu': 'green belt',
                '4 kyu': 'blue belt',
                '3 kyu': 'blue belt',
                '2 kyu': 'brown belt',
                '1 kyu': 'brown belt',
              }[gl]) }}
            {% elif gl and 'dan' in gl %}
              {{ _(gl ~ ' ‚Äì black belt') }}
            {% else %}
              {{ gl or player.belt_rank }}
            {% endif %}
          </span>
        </div>
      </div>
    </div>

    <!-- QUICK ACTIONS -->
    <div class="card">
      <div class="card-header"><strong>{{ _('Quick actions') }}</strong></div>
      <div class="card-body">

        <!-- PRINT DUE FEES -->
        <form class="row g-2 align-items-end" method="get"
              action="{{ url_for('player_due_print', player_id=player.id) }}">
          <div class="col-12">
            <label class="form-label m-0">{{ _('Print Due Fees') }}</label>
          </div>
          <div class="col-7">
            <input class="form-control"
                   type="text"
                   name="month"
                   placeholder="{{ _('YYYY-MM') }}"
                   aria-label="{{ _('YYYY-MM') }} {{ _('month (optional)') }}">
            <div class="form-text">{{ _('Leave empty for current month') }}</div>
          </div>
          <div class="col-5 d-grid">
            <button class="btn btn-outline-primary">üñ®Ô∏è {{ _('Print Due Fees') }}</button>
          </div>
        </form>

        <!-- EXPORT PLAYER CSV -->
        <div class="d-grid mt-2">
          <a class="btn btn-outline-success" href="{{ url_for('export_player_csv', player_id=player.id) }}">
            ‚¨áÔ∏è {{ _('Export Profile (CSV)') }}
          </a>
        </div>
        {% if session.get('is_admin') %}
        <hr />
        <div class="mt-2">
          <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#purgeModal">üö® {{ _('Permanently delete (PURGE)') }}</button>
        </div>

        <!-- Purge confirmation modal -->
        <div class="modal fade" id="purgeModal" tabindex="-1" aria-labelledby="purgeModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <form method="post" action="{{ url_for('purge_player', player_id=player.id) }}">
                <div class="modal-header">
                  <h5 class="modal-title" id="purgeModalLabel">{{ _('Permanently delete player') }}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <p class="text-danger">{{ _('This is irreversible. All player data will be removed but related historical rows will keep the PN#.') }}</p>
                  <p>{{ _('To confirm, type the word') }} <strong>PURGE</strong> {{ _('in the box below') }}.</p>
                  <div class="mb-2">
                    <input type="text" name="confirm" id="purge_confirm_input" class="form-control" placeholder="PURGE" required>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ _('Cancel') }}</button>
                  <button type="submit" id="purge_submit_btn" class="btn btn-danger" disabled>{{ _('Permanently delete') }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            var input = document.getElementById('purge_confirm_input');
            var btn = document.getElementById('purge_submit_btn');
            if (input && btn) {
              input.addEventListener('input', function() {
                btn.disabled = input.value.trim() !== 'PURGE';
              });
            }
          });
        </script>
        {% endif %}

        <hr>

        <!-- RECEIPT SHORTCUTS -->

        <hr>

        <!-- PAY DUES MODAL TRIGGER -->
        <div class="d-grid gap-2">

                <button class="btn btn-success pay-due-modal-btn" type="button" data-player-id="{{ player.id }}">{{ _('Pay All Dues') }}</button>
                <!-- Modal -->
                <div class="modal fade" id="payDueModal" tabindex="-1" aria-labelledby="payDueModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <form id="payDueForm">
                        <div class="modal-header">
                          <h5 class="modal-title" id="payDueModalLabel">Outstanding Dues</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <div id="duesList">
                            <div class="text-center text-muted py-3">Loading...</div>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                          <button type="submit" class="btn btn-success">Confirm Payment</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
            <script>
            document.addEventListener('DOMContentLoaded', function() {
              let currentPayDuePlayerId = null;
              document.querySelectorAll('.pay-due-modal-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                  currentPayDuePlayerId = this.getAttribute('data-player-id');
                  const payDueModalEl = document.getElementById('payDueModal');
                  try { if (payDueModalEl && payDueModalEl.parentNode !== document.body) document.body.appendChild(payDueModalEl); } catch(e){}
                  const payDueModal = new bootstrap.Modal(payDueModalEl);
                  document.getElementById('duesList').innerHTML = '<div class="text-center text-muted py-3">Loading...</div>';
                  payDueModal.show();
                  fetch(`/admin/players/${currentPayDuePlayerId}/dues_json`)
                    .then(response => response.json())
                    .then(data => {
                      const duesData = data.dues || [];
                      const duesList = document.getElementById('duesList');
                      if (!duesData.length) {
                        duesList.innerHTML = '<div class="text-center text-muted py-3">Nothing to show.</div>';
                        return;
                      }
                      duesList.innerHTML = duesData.map(function(due, idx) {
                        if (due.type === 'owed_sessions' && due.session_list) {
                          return `<div class="mb-2">
                            <div class="fw-bold mb-1">
                              ${due.label} <span class="badge bg-info text-dark ms-2">${due.amount} EUR</span>
                            </div>
                            <div class="ms-4 mt-2" id="sessions_${idx}">
                              ${due.session_list.map((sess, sidx) => `
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" value="${sess.session_id}" id="session_${sess.session_id}" name="session_ids_${idx}" checked>
                                  <label class="form-check-label" for="session_${sess.session_id}">
                                    ${sess.date} <span class="badge bg-secondary ms-2">${sess.session_id}</span>
                                  </label>
                                </div>
                              `).join('')}
                            </div>
                          </div>`;
                        } else {
                          return `<div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" value="${due.id}" id="due_${due.id}" name="dues">
                            <label class="form-check-label" for="due_${due.id}">
                              ${due.label} <span class="badge bg-info text-dark ms-2">${due.amount} EUR</span>
                            </label>
                          </div>`;
                        }
                      }).join('');
                    });
                });
              });
              document.getElementById('payDueForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (!currentPayDuePlayerId) return;
                var checked = Array.from(document.querySelectorAll('#duesList input[name="dues"]:checked')).map(cb => cb.value);
                var duesToSend = [];
                var checkedSessionCheckboxes = Array.from(document.querySelectorAll('input[name^="session_ids_"]:checked'));
                var sessionIds = checkedSessionCheckboxes.map(cb => cb.value);
                if (sessionIds.length > 0) {
                  duesToSend.push({type: 'owed_sessions', session_ids: sessionIds});
                }
                checked.forEach(function(val) {
                  duesToSend.push(val);
                });
                if (duesToSend.length === 0) return;
                fetch(`/admin/players/${currentPayDuePlayerId}/pay_due_receipt`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ dues: duesToSend })
                })
                .then(response => response.json())
                .then(data => {
                  // hide modal and cleanup backdrops, then open receipt in a new tab
                  try { document.querySelectorAll('.modal-backdrop').forEach(el=>el.remove()); document.body.classList.remove('modal-open'); } catch(e){}
                  try { document.querySelectorAll('#payDueModal.modal.show').forEach(m=>{ m.classList.remove('show'); m.style.display='none'; m.removeAttribute('aria-modal'); m.removeAttribute('role'); }); } catch(e){}
                  if (data.redirect) {
                    window.open(data.redirect, '_blank');
                  }
                });
              });
            });
            </script>
        </div>
      </div>
    </div>

    <!-- TRAINING SESSIONS -->
    <div class="card mt-3">
      <div class="card-header"><strong>{{ _('Training Sessions') }}</strong></div>
      <div class="card-body">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" id="sessionsTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar" type="button" role="tab" aria-controls="calendar" aria-selected="true">{{ _('Calendar') }}</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="list-tab" data-bs-toggle="tab" data-bs-target="#list" type="button" role="tab" aria-controls="list" aria-selected="false">{{ _('List') }}</button>
          </li>
        </ul>

        <!-- Tab content -->
        <div class="tab-content mt-3" id="sessionsTabContent">
          <!-- Calendar Tab -->
          <div class="tab-pane fade show active" id="calendar" role="tabpanel" aria-labelledby="calendar-tab">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="mb-0">{{ _('Training Calendar') }}</h5>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-secondary btn-sm" id="prev-month">‚Üê {{ _('Previous') }}</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="current-month">{{ _('Current Month') }}</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="next-month">{{ _('Next') }}</button>
              </div>
            </div>
            <div id="training-calendar"></div>
          </div>

          <!-- List Tab -->
          <div class="tab-pane fade" id="list" role="tabpanel" aria-labelledby="list-tab">
            {% if all_sessions %}
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>{{ _('Date') }}</th>
                      <th>{{ _('Status') }}</th>
                      <th>{{ _('Session ID') }}</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for session in all_sessions %}
                      <tr>
                        <td>{{ session.date }}</td>
                        <td>
                          {% if session.paid %}
                            <span class="badge bg-success">{{ _('Paid') }}</span>
                          {% else %}
                            <span class="badge bg-warning text-dark">{{ _('Unpaid') }}</span>
                          {% endif %}
                        </td>
                        <td><code>{{ session.session_id }}</code></td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="text-muted"><em>{{ _('No training sessions recorded yet.') }}</em></div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT COLUMN -->
  <div class="col-12 col-lg-8">

    <!-- PROFILE -->
    <div class="card mb-3">
      <div class="card-header"><strong>{{ _('Profile') }}</strong></div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-sm-6">
            <div><strong>{{ _('First Name') }}:</strong> {{ player.first_name }}</div>
            <div><strong>{{ _('Last Name') }}:</strong> {{ player.last_name }}</div>
            <div><strong>{{ _('Gender') }}:</strong> {{ _(player.gender) if player.gender else '‚Äî' }}</div>
            <div><strong>{{ _('Birthdate') }}:</strong> {{ player.birthdate or '‚Äî' }}</div>
             <div><strong>{{ _('PN#') }}:</strong> {{ player.pn or '‚Äî' }}</div>
          </div>
          <div class="col-sm-6">
            <div><strong>{{ _('Discipline') }}:</strong>{{ _(player.discipline) if player.discipline else '‚Äî' }}</div>
            <div><strong>{{ _('Weight (kg)') }}:</strong> {{ player.weight_kg or '‚Äî' }}</div>
            <div><strong>{{ _('Height (cm)') }}:</strong> {{ player.height_cm or '‚Äî' }}</div>
            <div><strong>{{ _('Join Date') }}:</strong> {{ player.join_date or '‚Äî' }}</div>
          </div>
        </div>
      </div>
    </div>


    <!-- CONTACTS & PARENTS -->
    <div class="card mb-3">
      <div class="card-header"><strong>{{ _('Contacts') }}</strong></div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-sm-6">
            <div><strong>{{ _('Email') }}:</strong> {{ player.email or '‚Äî' }}</div>
            <div><strong>{{ _('Phone') }}:</strong> {{ player.phone or '‚Äî' }}</div>
          </div>
          <div class="col-sm-6">
            <div><strong>{{ _('Mother Name') }}:</strong> {{ player.mother_name or '‚Äî' }}</div>
            <div><strong>{{ _('Mother Phone') }}:</strong> {{ player.mother_phone or '‚Äî' }}</div>
            <div><strong>{{ _('Father Name') }}:</strong> {{ player.father_name or '‚Äî' }}</div>
            <div><strong>{{ _('Father Phone') }}:</strong> {{ player.father_phone or '‚Äî' }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- HEALTH & INSURANCE -->
    <div class="card mb-3">
      <div class="card-header"><strong>{{ _('Health & Insurance') }}</strong></div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-sm-4"><strong>{{ _('Examination Date') }}:</strong> {{ player.medical_exam_date or '‚Äî' }}</div>
          <div class="col-sm-4"><strong>{{ _('Expiry Date') }}:</strong> {{ player.medical_expiry_date or '‚Äî' }}</div>
          <div class="col-sm-4"><strong>{{ _('Insurance Expiry Date') }}:</strong> {{ player.insurance_expiry_date or '‚Äî' }}</div>
        </div>
      </div>
    </div>

    <!-- NOTES -->
    {% if player.notes %}
    <div class="card mb-3">
      <div class="card-header"><strong>{{ _('Notes') }}</strong></div>
      <div class="card-body">
        <div>{{ player.notes }}</div>
      </div>
    </div>
    {% endif %}

    <!-- SPORTDATA PROFILES -->
    <div class="card mb-3">
      <div class="card-header"><strong>{{ _('Sportdata Profiles') }}</strong></div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-sm-4"><strong>{{ _('WKF Profile URL') }}:</strong> {% if player.sportdata_wkf_url %}<a href="{{ player.sportdata_wkf_url }}" target="_blank">{{ player.sportdata_wkf_url }}</a>{% else %}‚Äî{% endif %}</div>
          <div class="col-sm-4"><strong>{{ _('BNFK Profile URL') }}:</strong> {% if player.sportdata_bnfk_url %}<a href="{{ player.sportdata_bnfk_url }}" target="_blank">{{ player.sportdata_bnfk_url }}</a>{% else %}‚Äî{% endif %}</div>
          <div class="col-sm-4"><strong>{{ _('ENSO Profile URL') }}:</strong> {% if player.sportdata_enso_url %}<a href="{{ player.sportdata_enso_url }}" target="_blank">{{ player.sportdata_enso_url }}</a>{% else %}‚Äî{% endif %}</div>
        </div>
      </div>
    </div>

    <!-- RECENT EVENTS -->
    <div class="card">
      <div class="card-header"><strong>{{ _('Recent Event Registrations') }}</strong></div>
      <div class="card-body">
        {% if regs %}
          <table class="table table-sm">
            <thead>
              <tr>
                <th>#</th>
                <th>{{ _('Event') }}</th>
                <th>{{ _('Dates') }}</th>
                <th>{{ _('Fee (EUR)') }}</th>
                <th>{{ _('Paid') }}</th>
              </tr>
            </thead>
            <tbody>
              {% set medal_counts = {'gold': 0, 'silver': 0, 'bronze': 0} %}
              {% for r in regs %}
                {% for rc in r.reg_categories %}
                  {% if rc.medal %}
                    {% set _ = medal_counts.__setitem__(rc.medal, medal_counts.get(rc.medal, 0) + 1) %}
                  {% endif %}
                {% endfor %}
              <tr>
                <td>
                  <button class="btn btn-sm btn-link p-0" data-bs-toggle="collapse" data-bs-target="#reg-details-{{ r.id }}" aria-expanded="false" aria-controls="reg-details-{{ r.id }}">‚ñæ {{ r.id }}</button>
                </td>
                <td>{{ r.event.title }}</td>
                <td>{{ r.event.start_date }}</td>
                <td>{{ r.computed_fee() }}</td>
                <td>{{ _('yes') if r.paid else _('no') }}</td>
              </tr>
              <tr class="collapse" id="reg-details-{{ r.id }}">
                <td colspan="7">
                  {% if r.reg_categories %}
                    <div class="ps-3">
                      <strong>{{ _('Categories & Medals') }}:</strong>
                      <ul class="mb-0">
                        {% for rc in r.reg_categories %}
                          <li>
                            {{ rc.category.name if rc.category else '‚Äî' }}
                            {% if rc.medal %}
                              <span class="badge {% if rc.medal == 'gold' %}bg-warning text-dark{% elif rc.medal == 'silver' %}bg-secondary{% elif rc.medal == 'bronze' %}bg-warning" style="color:#cd7f32!important;"{% endif %}">
                                {{ rc.medal|capitalize }}
                              </span>
                            {% endif %}
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                  {% else %}
                    <em>{{ _('No categories for this registration.') }}</em>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr class="fw-bold bg-light">
                <td colspan="3" class="text-end">{{ _('Total medals') }}</td>
                <td colspan="4">
                  <span class="me-3">ü•á {{ medal_counts['gold'] }}</span>
                  <span class="me-3">ü•à {{ medal_counts['silver'] }}</span>
                  <span>ü•â {{ medal_counts['bronze'] }}</span>
                </td>
              </tr>
            </tfoot>
          </table>
        {% else %}
          <em>{{ _('No registrations yet.') }}</em>
        {% endif %}
      </div>
    </div>

  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Training sessions calendar
  const sessions = {{ all_sessions|tojson }};
  let currentDate = new Date();

  function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());

    const calendar = document.getElementById('training-calendar');
    calendar.innerHTML = '';

    // Month/Year header
    const header = document.createElement('h6');
    header.className = 'text-center mb-3';
    header.textContent = date.toLocaleDateString('{{ current_lang }}', { year: 'numeric', month: 'long' });
    calendar.appendChild(header);

    // Days of week header
    const daysOfWeek = ['{{ _('Sun') }}', '{{ _('Mon') }}', '{{ _('Tue') }}', '{{ _('Wed') }}', '{{ _('Thu') }}', '{{ _('Fri') }}', '{{ _('Sat') }}'];
    const weekHeader = document.createElement('div');
    weekHeader.className = 'row g-1 mb-2';
    daysOfWeek.forEach(day => {
      const dayCell = document.createElement('div');
      dayCell.className = 'col text-center fw-bold small';
      dayCell.textContent = day;
      weekHeader.appendChild(dayCell);
    });
    calendar.appendChild(weekHeader);

    // Calendar grid
    let currentWeek = document.createElement('div');
    currentWeek.className = 'row g-1 mb-1';

    for (let d = new Date(startDate); d <= lastDay || currentWeek.children.length < 7; d.setDate(d.getDate() + 1)) {
      if (currentWeek.children.length === 7) {
        calendar.appendChild(currentWeek);
        currentWeek = document.createElement('div');
        currentWeek.className = 'row g-1 mb-1';
      }

      const dayCell = document.createElement('div');
      dayCell.className = 'col';

      const dayButton = document.createElement('button');
      dayButton.className = 'btn btn-sm w-100 position-relative';
      dayButton.textContent = d.getDate();

      // Check if this date has sessions
      const dateStr = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
      const daySessions = sessions.filter(s => s.date === dateStr);

      if (daySessions.length > 0) {
        dayButton.classList.add('btn-success');
        const badge = document.createElement('span');
        badge.className = 'badge bg-light text-dark position-absolute top-0 end-0';
        badge.style.fontSize = '0.7em';
        badge.textContent = daySessions.length;
        dayButton.appendChild(badge);

        // Add tooltip with session details
        const paidText = '{{ _('Paid') }}';
        const unpaidText = '{{ _('Unpaid') }}';
        dayButton.title = daySessions.map(s => `${s.session_id} (${s.paid ? paidText : unpaidText})`).join('\n');
      } else if (d.getMonth() === month) {
        dayButton.classList.add('btn-outline-secondary');
      } else {
        dayButton.classList.add('btn-light');
        dayButton.disabled = true;
      }

      dayCell.appendChild(dayButton);
      currentWeek.appendChild(dayCell);
    }

    if (currentWeek.children.length > 0) {
      calendar.appendChild(currentWeek);
    }
  }

  // Initial render
  renderCalendar(currentDate);

  // Navigation buttons
  document.getElementById('prev-month').addEventListener('click', function() {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar(currentDate);
  });

  document.getElementById('next-month').addEventListener('click', function() {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar(currentDate);
  });

  document.getElementById('current-month').addEventListener('click', function() {
    currentDate = new Date();
    renderCalendar(currentDate);
  });
});
</script>
{% endblock %}