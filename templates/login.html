{% extends "base.html" %}
{% block head %}
  {{ super() }}
  <script>console.log('Before socket.io script');</script>
  <script src="/static/js/socket.io.js?v=3"></script>
  <script>console.log('After socket.io script, typeof io:', typeof io);</script>
{% endblock %}
{% block content %}
<h1 class="mb-4">{{ _('Admin Login') }}</h1>

<!-- Card Login Section -->
<div class="card mb-4">
  <div class="card-body text-center">
    <h5 class="card-title">{{ _('Card Login') }}</h5>
    <p class="card-text">{{ _('Scan your admin card to login automatically') }}</p>
    <form method="post" action="{{ url_for('login', next=next_url) }}" id="card_login_form">
      <input type="hidden" name="card_id" id="card_id_input">
      <div class="mb-3">
        <div class="alert alert-info">
          <i class="fas fa-credit-card fa-2x mb-2"></i>
          <br>
          <strong>{{ _('Card Reader Active') }}</strong>
          <br>
          {{ _('Please scan your admin card') }}
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Password Login Section -->
<div class="card">
  <div class="card-body">
    <h5 class="card-title">{{ _('Password Login') }}</h5>
    <form method="post" action="{{ url_for('login', next=next_url) }}">
      <div class="mb-3">
        <label class="form-label">{{ _('Username') }}</label>
        <input class="form-control" name="username" autocomplete="username" required>
      </div>
      <div class="mb-3">
        <label class="form-label">{{ _('Password') }}</label>
        <input class="form-control" name="password" type="password" autocomplete="current-password" required>
      </div>
      <button class="btn btn-primary" type="submit">{{ _('Login') }}</button>
    </form>
  </div>
</div>

<div class="mt-3">
  <a class="btn btn-secondary" href="/">{{ _('Back') }}</a>
</div>

<script>
  // Card login functionality
  document.addEventListener('DOMContentLoaded', function() {
    const cardIdInput = document.getElementById('card_id_input');
    const cardLoginForm = document.getElementById('card_login_form');
    
    // Card reader functionality via SocketIO
    const socket = io();

    socket.on('card_scan', function(data) {
      cardIdInput.value = data.card_id;
      cardLoginForm.submit();
    });
  });
</script>

{% endblock %}